<%- include('partial/head.ejs')%>
<!-- Load Leaflet from CDN -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin="" />
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>

<!-- Load Esri Leaflet from CDN -->
<script src="https://unpkg.com/esri-leaflet@2.3.3/dist/esri-leaflet.js"
   integrity="sha512-cMQ5e58BDuu1pr9BQ/eGRn6HaR6Olh0ofcHFWe5XesdCITVuSBiBZZbhCijBe5ya238f/zMMRYIMIIg1jxv4sQ=="
   crossorigin=""></script>

<!-- Load Esri Leaflet Geocoder from CDN -->
<link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.3.2/dist/esri-leaflet-geocoder.css"
   integrity="sha512-IM3Hs+feyi40yZhDH6kV8vQMg4Fh20s9OzInIIAc4nx7aMYMfo+IenRUekoYsHZqGkREUgx0VvlEsgm7nCDW9g=="
   crossorigin="" />
<script src="https://unpkg.com/esri-leaflet-geocoder@2.3.2/dist/esri-leaflet-geocoder.js"
   integrity="sha512-8twnXcrOGP3WfMvjB0jS5pNigFuIWj4ALwWEgxhZ+mxvjF5/FBPVd5uAxqT8dd2kUmTVK9+yQJ4CmTmSg/sXAQ=="
   crossorigin=""></script>

<style>
   body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
   }

   #map {
      
     
      position: relative;
      width: 700px;
      height: 500px;
      /* margin-bottom: 30px; */
      margin-left: 400px;
      top: 0;
      bottom: 0;
      right: 0;
      left: 0;
      z-index: 1;
      
   }
   .submit-info{
      margin-left: 220px;
      
   }
</style>

<body>

   <!--? Preloader Start -->
   <div id="preloader-active">
      <div class="preloader d-flex align-items-center justify-content-center">
         <div class="preloader-inner position-relative">
            <div class="preloader-circle"></div>
            <div class="preloader-img pere-text">
               <img src="assets/img/logo/loder.png" alt="">
            </div>
         </div>
      </div>
   </div>
   <!-- Preloader Start -->
   <%- include('partial/header.ejs')%>
   <main>
      <!--? Hero Start -->
      <div class="slider-area2">
         <div class="slider-height2 d-flex align-items-center">
            <div class="container">
               <div class="row">
                  <div class="col-xl-12">
                     <div class="hero-cap hero-cap2 pt-70 text-center">
                        <h2>LES BRASSEURS</h2>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>

      <!-- formulaire de recherche -->
      <section class="blog_area single-post-area section-padding">
         <div class="container">
            <div class="row">
               <div class="col-lg-8 posts-list">
                  <div class="single-post">
                     <div class="feature-img">
                        <img class="img-fluid" src="" alt="">
                     </div>

                     <div class="container ">
                        <div class="row ">
                           <div class="col-xl-5 col-lg-5 col-md-6 ">
                              
                              <form>
                                 <select class="mdb-select validate md-form  searchable=" Search here..">
                                    <option value="" disabled selected>choisir votre departement</option>
                                    <% departement.forEach((departement, index) => { %>
                                    <option value="<%= departement.departement_id %>">
                                       <%= departement.departement_nom_uppercase %></option>
                                    <% }) %>
                                    
                                 </select>
                                 <div class="submit-info">
                                    <button class="btn" type="submit">valider</button>
                                </div>
                                <div id="map"></div>
                                    
                               
                              </form>
                              

                           </div>
                        </div>
                     </div>

                  </div>
               </div>
            </div>
            
                     
              
      </section>

      <script>
         var map = L.map('map').setView([40.91, -96.63], 4);
       
         L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
           attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors'
         }).addTo(map);
       
         var searchControl = L.esri.Geocoding.geosearch().addTo(map);
       
         var results = L.layerGroup().addTo(map);
       
         searchControl.on('results', function (data) {
           results.clearLayers();
           for (var i = data.results.length - 1; i >= 0; i--) {
             results.addLayer(L.marker(data.results[i].latlng));
           }
         });
       </script>
      <!-- <script>
         // https://esri.github.io/esri-leaflet/examples/geocoding-control.html

         const coordsParis = {
            lat: 48.866667,
            lng: 2.333333
         };
         let coordsFromBrowser = {
            lat: coordsParis.lat,
            lng: coordsParis.lng
         };

         navigator.geolocation.getCurrentPosition(function (position) {
            console.log(
               "position",
               position.coords.latitude,
               position.coords.longitude
            );

            coordsFromBrowser.lat = position.coords.latitude;
            coordsFromBrowser.lng = position.coords.longitude;

            map.setView([coordsFromBrowser.lat, coordsFromBrowser.lng], 15);
         });

         const map = L.map("map").setView(
            [coordsFromBrowser.lat, coordsFromBrowser.lng],
            7
         );

         L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
         }).addTo(map);

         const searchControl = L.esri.Geocoding.geosearch().addTo(map);

         const results = L.layerGroup().addTo(map);

         let markers = [];

         searchControl.on("results", function (data) {
            markers = [];
            console.log("data", data);
            results.clearLayers();
            // several results as several towns with same name (like)
            for (var i = data.results.length - 1; i >= 0; i--) {
               const result = data.results[i];
               const marker = L.marker(result.latlng);
               markers = [...markers, L.marker(marker)];
               results.addLayer(marker);
               marker.on("click", addRadius);
               console.log("markers", markers);
            }
         });

         function addRadius(marker, radius = 1000) {
            console.log("marker clicked", marker);
            const circle = L.circle([marker.latlng.lat, marker.latlng.lng], {
               radius,
            });
            console.log("circle", circle);
            circle.addTo(map);
            setTimeout(() => {
               map.setZoom(15);
            }, 1000);
         }
      </script> -->
   </main>

   <%- include('partial/footer.ejs')%>